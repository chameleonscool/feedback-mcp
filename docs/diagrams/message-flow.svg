<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 900 650">
  <defs>
    <linearGradient id="titleGrad2" x1="0%" y1="0%" x2="100%" y2="0%">
      <stop offset="0%" style="stop-color:#059669"/>
      <stop offset="100%" style="stop-color:#0891b2"/>
    </linearGradient>
    <filter id="shadow2" x="-20%" y="-20%" width="140%" height="140%">
      <feDropShadow dx="2" dy="2" stdDeviation="2" flood-opacity="0.1"/>
    </filter>
    <marker id="arrowBlue" markerWidth="10" markerHeight="7" refX="9" refY="3.5" orient="auto">
      <polygon points="0 0, 10 3.5, 0 7" fill="#3b82f6"/>
    </marker>
    <marker id="arrowGreen2" markerWidth="10" markerHeight="7" refX="9" refY="3.5" orient="auto">
      <polygon points="0 0, 10 3.5, 0 7" fill="#22c55e"/>
    </marker>
    <marker id="arrowPink" markerWidth="10" markerHeight="7" refX="9" refY="3.5" orient="auto">
      <polygon points="0 0, 10 3.5, 0 7" fill="#ec4899"/>
    </marker>
    <marker id="arrowOrange" markerWidth="10" markerHeight="7" refX="9" refY="3.5" orient="auto">
      <polygon points="0 0, 10 3.5, 0 7" fill="#f59e0b"/>
    </marker>
  </defs>
  
  <!-- Title -->
  <rect x="0" y="0" width="900" height="50" fill="url(#titleGrad2)"/>
  <text x="450" y="32" text-anchor="middle" fill="white" font-family="Arial, sans-serif" font-size="20" font-weight="bold">
    æ¶ˆæ¯æ”¶å‘æµç¨‹å›¾
  </text>
  
  <!-- Actors -->
  <rect x="60" y="70" width="100" height="40" rx="20" fill="#dbeafe" stroke="#3b82f6" stroke-width="2" filter="url(#shadow2)"/>
  <text x="110" y="95" text-anchor="middle" font-family="Arial, sans-serif" font-size="12" font-weight="bold" fill="#1e40af">ğŸ¤– AI Agent</text>
  
  <rect x="260" y="70" width="100" height="40" rx="20" fill="#dcfce7" stroke="#22c55e" stroke-width="2" filter="url(#shadow2)"/>
  <text x="310" y="95" text-anchor="middle" font-family="Arial, sans-serif" font-size="12" font-weight="bold" fill="#166534">âš™ï¸ MCP Server</text>
  
  <rect x="460" y="70" width="100" height="40" rx="20" fill="#fef3c7" stroke="#f59e0b" stroke-width="2" filter="url(#shadow2)"/>
  <text x="510" y="95" text-anchor="middle" font-family="Arial, sans-serif" font-size="12" font-weight="bold" fill="#92400e">ğŸ’¾ Database</text>
  
  <rect x="660" y="70" width="100" height="40" rx="20" fill="#fce7f3" stroke="#ec4899" stroke-width="2" filter="url(#shadow2)"/>
  <text x="710" y="95" text-anchor="middle" font-family="Arial, sans-serif" font-size="12" font-weight="bold" fill="#9d174d">ğŸ“± é£ä¹¦</text>
  
  <!-- User Actor (on right) -->
  <rect x="780" y="70" width="80" height="40" rx="20" fill="#e0e7ff" stroke="#6366f1" stroke-width="2" filter="url(#shadow2)"/>
  <text x="820" y="95" text-anchor="middle" font-family="Arial, sans-serif" font-size="12" font-weight="bold" fill="#4338ca">ğŸ‘¤ ç”¨æˆ·</text>
  
  <!-- Lifelines -->
  <line x1="110" y1="110" x2="110" y2="600" stroke="#3b82f6" stroke-width="2" stroke-dasharray="5,5"/>
  <line x1="310" y1="110" x2="310" y2="600" stroke="#22c55e" stroke-width="2" stroke-dasharray="5,5"/>
  <line x1="510" y1="110" x2="510" y2="600" stroke="#f59e0b" stroke-width="2" stroke-dasharray="5,5"/>
  <line x1="710" y1="110" x2="710" y2="600" stroke="#ec4899" stroke-width="2" stroke-dasharray="5,5"/>
  <line x1="820" y1="110" x2="820" y2="600" stroke="#6366f1" stroke-width="2" stroke-dasharray="5,5"/>
  
  <!-- Step 1: Call MCP Tool -->
  <rect x="20" y="130" width="20" height="20" rx="10" fill="#3b82f6"/>
  <text x="30" y="145" text-anchor="middle" font-family="Arial, sans-serif" font-size="11" font-weight="bold" fill="white">1</text>
  <line x1="110" y1="140" x2="300" y2="140" stroke="#3b82f6" stroke-width="2" marker-end="url(#arrowBlue)"/>
  <text x="205" y="135" text-anchor="middle" font-family="Arial, sans-serif" font-size="11" fill="#1e40af">collect_user_intent(question)</text>
  
  <!-- Step 2: Read API Key -->
  <rect x="20" y="165" width="20" height="20" rx="10" fill="#22c55e"/>
  <text x="30" y="180" text-anchor="middle" font-family="Arial, sans-serif" font-size="11" font-weight="bold" fill="white">2</text>
  <rect x="250" y="155" width="120" height="35" rx="4" fill="#dcfce7" stroke="#22c55e" stroke-width="1"/>
  <text x="310" y="173" text-anchor="middle" font-family="Arial, sans-serif" font-size="10" fill="#166534">è¯»å–ç¯å¢ƒå˜é‡</text>
  <text x="310" y="185" text-anchor="middle" font-family="Arial, sans-serif" font-size="9" fill="#15803d">USERINTENT_API_KEY</text>
  
  <!-- Step 3: Query User -->
  <rect x="20" y="205" width="20" height="20" rx="10" fill="#22c55e"/>
  <text x="30" y="220" text-anchor="middle" font-family="Arial, sans-serif" font-size="11" font-weight="bold" fill="white">3</text>
  <line x1="310" y1="215" x2="500" y2="215" stroke="#22c55e" stroke-width="2" marker-end="url(#arrowGreen2)"/>
  <text x="405" y="210" text-anchor="middle" font-family="Arial, sans-serif" font-size="11" fill="#166534">æŸ¥è¯¢ç”¨æˆ· by API Key</text>
  
  <!-- Step 4: Return User Info -->
  <rect x="20" y="240" width="20" height="20" rx="10" fill="#f59e0b"/>
  <text x="30" y="255" text-anchor="middle" font-family="Arial, sans-serif" font-size="11" font-weight="bold" fill="white">4</text>
  <line x1="500" y1="250" x2="320" y2="250" stroke="#f59e0b" stroke-width="2" marker-end="url(#arrowOrange)"/>
  <text x="410" y="245" text-anchor="middle" font-family="Arial, sans-serif" font-size="11" fill="#92400e">è¿”å› user.open_id</text>
  
  <!-- Step 5: Store Intent -->
  <rect x="20" y="275" width="20" height="20" rx="10" fill="#22c55e"/>
  <text x="30" y="290" text-anchor="middle" font-family="Arial, sans-serif" font-size="11" font-weight="bold" fill="white">5</text>
  <line x1="310" y1="285" x2="500" y2="285" stroke="#22c55e" stroke-width="2" marker-end="url(#arrowGreen2)"/>
  <text x="405" y="280" text-anchor="middle" font-family="Arial, sans-serif" font-size="11" fill="#166534">å­˜å‚¨ intent_queue</text>
  
  <!-- Step 6: Send to Feishu -->
  <rect x="20" y="310" width="20" height="20" rx="10" fill="#22c55e"/>
  <text x="30" y="325" text-anchor="middle" font-family="Arial, sans-serif" font-size="11" font-weight="bold" fill="white">6</text>
  <line x1="310" y1="320" x2="700" y2="320" stroke="#22c55e" stroke-width="2" marker-end="url(#arrowGreen2)"/>
  <text x="505" y="315" text-anchor="middle" font-family="Arial, sans-serif" font-size="11" fill="#166534">å‘é€æ¶ˆæ¯ (receive_id=open_id)</text>
  
  <!-- Step 7: Feishu to User -->
  <rect x="20" y="345" width="20" height="20" rx="10" fill="#ec4899"/>
  <text x="30" y="360" text-anchor="middle" font-family="Arial, sans-serif" font-size="11" font-weight="bold" fill="white">7</text>
  <line x1="710" y1="355" x2="830" y2="355" stroke="#ec4899" stroke-width="2" marker-end="url(#arrowPink)"/>
  <text x="770" y="350" text-anchor="middle" font-family="Arial, sans-serif" font-size="11" fill="#9d174d">æ¨é€æ¶ˆæ¯</text>
  
  <!-- Step 8: User Reply -->
  <rect x="20" y="380" width="20" height="20" rx="10" fill="#6366f1"/>
  <text x="30" y="395" text-anchor="middle" font-family="Arial, sans-serif" font-size="11" font-weight="bold" fill="white">8</text>
  <line x1="810" y1="390" x2="720" y2="390" stroke="#6366f1" stroke-width="2" marker-end="url(#arrowPink)"/>
  <text x="765" y="385" text-anchor="middle" font-family="Arial, sans-serif" font-size="11" fill="#4338ca">ç”¨æˆ·å›å¤</text>
  
  <!-- Step 9: WebSocket Event -->
  <rect x="20" y="415" width="20" height="20" rx="10" fill="#ec4899"/>
  <text x="30" y="430" text-anchor="middle" font-family="Arial, sans-serif" font-size="11" font-weight="bold" fill="white">9</text>
  <line x1="700" y1="425" x2="320" y2="425" stroke="#ec4899" stroke-width="2" marker-end="url(#arrowPink)"/>
  <text x="510" y="420" text-anchor="middle" font-family="Arial, sans-serif" font-size="11" fill="#9d174d">WebSocket äº‹ä»¶ (im.message.receive)</text>
  
  <!-- Step 10: Update Database -->
  <rect x="20" y="450" width="20" height="20" rx="10" fill="#22c55e"/>
  <text x="30" y="465" text-anchor="middle" font-family="Arial, sans-serif" font-size="11" font-weight="bold" fill="white">10</text>
  <line x1="310" y1="460" x2="500" y2="460" stroke="#22c55e" stroke-width="2" marker-end="url(#arrowGreen2)"/>
  <text x="405" y="455" text-anchor="middle" font-family="Arial, sans-serif" font-size="11" fill="#166534">æ›´æ–° intent_queue</text>
  
  <!-- Step 11: Return Reply -->
  <rect x="20" y="485" width="20" height="20" rx="10" fill="#22c55e"/>
  <text x="30" y="500" text-anchor="middle" font-family="Arial, sans-serif" font-size="11" font-weight="bold" fill="white">11</text>
  <line x1="300" y1="495" x2="120" y2="495" stroke="#22c55e" stroke-width="2" marker-end="url(#arrowGreen2)"/>
  <text x="210" y="490" text-anchor="middle" font-family="Arial, sans-serif" font-size="11" fill="#166534">è¿”å›ç”¨æˆ·å›å¤</text>
  
  <!-- Final State -->
  <rect x="50" y="520" width="180" height="35" rx="6" fill="#dbeafe" stroke="#3b82f6" stroke-width="2"/>
  <text x="140" y="542" text-anchor="middle" font-family="Arial, sans-serif" font-size="12" font-weight="bold" fill="#1e40af">âœ… AI ç»§ç»­æ‰§è¡Œä»»åŠ¡</text>
  
  <!-- Alternative Path: Web UI -->
  <rect x="450" y="520" width="400" height="70" rx="8" fill="#f0fdf4" stroke="#22c55e" stroke-width="2" stroke-dasharray="4,4"/>
  <text x="650" y="540" text-anchor="middle" font-family="Arial, sans-serif" font-size="11" font-weight="bold" fill="#166534">ğŸ“ å¤‡é€‰è·¯å¾„ï¼šWeb UI å›å¤</text>
  <text x="650" y="558" text-anchor="middle" font-family="Arial, sans-serif" font-size="10" fill="#64748b">ç”¨æˆ·ä¹Ÿå¯ä»¥åœ¨ Web UI ä¸­æŸ¥çœ‹é—®é¢˜å¹¶å›å¤</text>
  <text x="650" y="575" text-anchor="middle" font-family="Arial, sans-serif" font-size="10" fill="#64748b">ç³»ç»Ÿè‡ªåŠ¨åŒæ­¥åˆ° intent_queueï¼ŒAI è·å¾—å“åº”</text>
  
  <!-- Legend -->
  <rect x="50" y="560" width="180" height="35" rx="6" fill="#fef3c7" stroke="#f59e0b" stroke-width="1"/>
  <text x="140" y="582" text-anchor="middle" font-family="Arial, sans-serif" font-size="10" fill="#92400e">ğŸ’¡ API Key æœªé…ç½®æ—¶ï¼Œé™çº§åˆ° Web UI</text>
</svg>
